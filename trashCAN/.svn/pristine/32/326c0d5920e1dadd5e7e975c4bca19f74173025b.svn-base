using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using ItrashCAN;

namespace AEODRS_System
{
    public enum CM_PWR_ObjectTypes : uint
    {
        MASTER_POWER_MANAGEMENT_CONTROLLER = 0,
        BUS_CONTROLLER = 1,
        POWER_DISTIRBUTION_CHANNEL = 2,
        SYSTEM_DEBUG_CONTROLLER = 0xE,
        ALL_OBJECTS = 0xF
    }

    public enum CM_PWR_SystemMessageTypes : uint
    {
        PING = 0,
        PONG = 1,
        DEBUG = 2,
        DEBUG_PRINTF = 0xF
    }


    public  class CM_PWR_MessageFactory
    {

        public static CM_PWR_ObjectTypes GetSourceObjectType(CANMsg Msg)
        {
            return (CM_PWR_ObjectTypes)(((Msg.CANId)>>25) & 0xF);
        }

        public static uint GetSourceObjectIndex(CANMsg Msg)
        {
            return (uint)(((Msg.CANId) >> 18) & 0x7F);
        }

        public static CM_PWR_ObjectTypes GetDestinationObjectType(CANMsg Msg)
        {
            return (CM_PWR_ObjectTypes)(((Msg.CANId) >> 14) & 0xF);
        }

        public static uint GetDestinationObjectIndex(CANMsg Msg)
        {
            return (uint)(((Msg.CANId) >> 7) & 0x7F);
        }

        public static CM_PWR_SystemMessageTypes GetMessageType(CANMsg Msg)
        {
            return (CM_PWR_SystemMessageTypes)(Msg.CANId & 0x7F);
        }


        public static CANMsg MakePing(CM_PWR_ObjectTypes SrcObjType,
                             uint SrcIndex,
                             CM_PWR_ObjectTypes DstObjType,
                             uint DstIndex)
        {
            CANMsg PingMsg = new CANMsg();

            PingMsg.ExtendedID = true;
            PingMsg.CANData = new byte[0];


            PingMsg.CANId = ((uint)SrcObjType << 25) |
                            ((SrcIndex & 0x7F) << 18) |
                            ((uint)DstObjType << 14) |
                            ((DstIndex & 0x7F) << 7) |
                            ((uint)CM_PWR_SystemMessageTypes.PING);

            return PingMsg;
        }


    }

}
