using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using ItrashCAN;

namespace AEODRS_System
{
    public enum CM_PWR_ObjectTypes : uint
    {
        MPMC = 0,
        BC = 1,
        PDC = 2,
        SDC = 0xE,
        ALL_OBJECTS = 0xF
    }

    public enum CM_PWR_Index : uint
    {
            ALL_INDICIES= 0x7F
    }

    public enum CM_PWR_SystemMessageTypes : uint
    {
        PING = 0,
        PONG = 1,
        DEBUG = 2,
        DEBUG_PRINTF = 0xF
    }

    public enum CM_PWR_DebugCommands : uint
    {
        ENABLE_PRINTF = 1,
        DISABLE_PRINTF = 0
    }

    public  class CM_PWR_MessageFactory
    {

        public static CM_PWR_ObjectTypes GetSourceObjectType(CAN_t Msg)
        {
            return (CM_PWR_ObjectTypes)(((Msg.ID)>>25) & 0xF);
        }

        public static uint GetSourceObjectIndex(CAN_t Msg)
        {
            return (uint)(((Msg.ID) >> 18) & 0x7F);
        }

        public static CM_PWR_ObjectTypes GetDestinationObjectType(CAN_t Msg)
        {
            return (CM_PWR_ObjectTypes)(((Msg.ID) >> 14) & 0xF);
        }

        public static uint GetDestinationObjectIndex(CAN_t Msg)
        {
            return (uint)(((Msg.ID) >> 7) & 0x7F);
        }

        public static CM_PWR_SystemMessageTypes GetMessageType(CAN_t Msg)
        {
            return (CM_PWR_SystemMessageTypes)(Msg.ID & 0x7F);
        }


        public static CAN_t MakePing(CM_PWR_ObjectTypes SrcObjType,
                             uint SrcIndex,
                             CM_PWR_ObjectTypes DstObjType,
                             uint DstIndex)
        {
            CAN_t PingMsg = new CAN_t();

            PingMsg.ExtendedID = true;
            PingMsg.Data = new byte[0];


            PingMsg.ID = ((uint)SrcObjType << 25) |
                            ((SrcIndex & 0x7F) << 18) |
                            ((uint)DstObjType << 14) |
                            ((DstIndex & 0x7F) << 7) |
                            ((uint)CM_PWR_SystemMessageTypes.PING);

            return PingMsg;
        }

        public static CAN_t MakeEnableDebugPrintf(CM_PWR_ObjectTypes SrcObjType,
                                                      uint SrcIndex,
                                                      CM_PWR_ObjectTypes DstObjType,
                                                      uint DstIndex)
        {
            CAN_t PingMsg = new CAN_t();

            PingMsg.ExtendedID = true;
            PingMsg.Data = new byte[1];


            PingMsg.ID = ((uint)SrcObjType << 25) |
                            ((SrcIndex & 0x7F) << 18) |
                            ((uint)DstObjType << 14) |
                            ((DstIndex & 0x7F) << 7) |
                            ((uint)CM_PWR_SystemMessageTypes.DEBUG);

            PingMsg.Data[0] = (byte)CM_PWR_DebugCommands.ENABLE_PRINTF;

            return PingMsg;
        }

        public static CAN_t MakeDisableDebugPrintf(CM_PWR_ObjectTypes SrcObjType,
                   uint SrcIndex,
                   CM_PWR_ObjectTypes DstObjType,
                   uint DstIndex)
        {
            CAN_t PingMsg = new CAN_t();

            PingMsg.ExtendedID = true;
            PingMsg.Data = new byte[1];


            PingMsg.ID = ((uint)SrcObjType << 25) |
                            ((SrcIndex & 0x7F) << 18) |
                            ((uint)DstObjType << 14) |
                            ((DstIndex & 0x7F) << 7) |
                            ((uint)CM_PWR_SystemMessageTypes.DEBUG);

            PingMsg.Data[0] = (byte)CM_PWR_DebugCommands.DISABLE_PRINTF;

            return PingMsg;
        }

        public static string MakeSourceID_String(CAN_t M)
        {

            string t1;
            string t2;

            t1 = Enum.GetName(typeof(CM_PWR_ObjectTypes),GetSourceObjectType(M));
            t2 = GetSourceObjectIndex(M).ToString();

            return "<" + t1 + ":" + t2 + ">";

        }

        public static string MakeDestinationID_String(CAN_t M)
        {

            string t1;
            string t2;

            t1 = Enum.GetName(typeof(CM_PWR_ObjectTypes), GetDestinationObjectType(M));
            t2 = GetDestinationObjectIndex(M).ToString();
     
            return "<" + t1 + ":" + t2 + ">";
        }

    }

}
